/**
 * pop框业务逻辑js
 */
var ELEMENT_POP = {
	stationInfo : {},
	warnPro : "",
	warnProId : "",
	importantElement : {},
	referenceProductLayerIds : [],//相关产品的layerId集合用于清除图层
	init : function(data){
		this.clearAllLayer();
		this.stationInfo = data;//获取gis回调传递的数据
		this.bindEvent();
		this.initElementContent(data);
	},
	initElementContent : function(data){//初始化pop内容
		var that = this;
		//预警产品对应的pop框信息的key
		var warnProObj = {
			"S_RAIN05" : "autostation",   //自动站   降水  30分钟降水
			"S_RAIN1" : "autostation",   //自动站   降水  1H降水
			"S_RAIN3" : "autostation",   //自动站   降水  3H降水
			"S_RAIN6" : "autostation",   //自动站   降水  6H降水
			"S_RAIN12" : "autostation",   //自动站   降水  12H降水
			"S_RAIN24" : "autostation",  //自动站   降水  24H降水
			"S_GALE_T" : "autostation",    //自动站    大风
			"S_GALE_E" : "autostation",    //自动站    极大风
			"S_V" : "autostation",		 //自动站    能见度
			"S_H_T_S" : "autostation", 	 //自动站    高温
			"S_H_T_MA" : "autostation",  //自动站    高温   最高温
			"S_H_T_MI" : "autostation",  //自动站    高温   最低高温
			"S_SP_1HV" : "autostation",  //自动站    变压  1H变压
			"S_SP_3HV" : "autostation",  //自动站    变压  3H变压
			"S_T_1HV" : "autostation",   //自动站    降温  1H变温
			"S_T_24HV" : "autostation",  //自动站    降温 24H变温
			"S_T_24MI" : "autostation",  //自动站    降温 日最低温度变温
			"S_SNOW" : "autostation",    //自动站    雪
			"S_HAIL" : "hail",			 //雷达站    冰雹
			"S_MESO" : "meso",			 //雷达站    中气旋
			"S_TORNAD" : "tornad",		 //雷达站    龙卷
			"S_STORM" : "storm",		 //雷达站    风暴
			"S_TITAN" : "titan",		 //雷达站	TITAN
			"S_LIGHT" : "light",		 //雷达站	闪电
			"S_RADA" : "rada",		 	 //雷达站	回波
			"K_RAIN" : "heavyrain",		 //落区       暴雨
			"K_TP24H" : "heavyrain",	 //落区      暴雨
			"K_EDA"  : "heavywind",		 //落区      大风
			"K_T_VAR"  : "t_var",	 	 //落区     寒潮
			"K_SNOW"  : "snow",	 		 //落区      暴雪
			"K_FROST"  : "frost",	 	 //落区      霜冻
			"K_H_T" : "htemp",			 //落区    高温
			"K_VIS" : "vis",			 //落区   低能度
		};
		
		var importantElement = {
			"I_FOG"    : {name : "雾", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iVisVal"]},
			"I_FROST"  : {name : "霜冻", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iVisVal"]},
			"I_GALE_E" : {name : "风", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iWsExtVal", "iWindExtDir"]},
			"I_HAIL"   : {name : "冰雹", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iMaxDiamVal"]},
			"I_HAZE"   : {name : "霾", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iVisVal"]},
			"I_LIGHT"  : {name : "雷暴", items : ["lon", "lat", "stationId", "stationName", "bjDatetime"]},
			"I_RAIN1"  : {name : "1小时降水", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iRain1Val"]},
			"I_RAIN24" : {name : "暴雨", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iRain24Val"]},
			"I_RAIN3"  : {name : "3小时降水", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iRain3Val"]},
			"I_RAIN6"  : {name : "6小时降水", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iRain6Val"]},
			"I_SAND"   : {name : "沙尘", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iVisVal"]},
			"I_SNOW"   : {name : "积雪", items : ["lon", "lat", "stationId", "stationName", "bjDatetime", "iSnowVal"]},
			"I_TORNAD" : {name : "龙卷风", items : ["lon", "lat", "stationId", "stationName", "bjDatetime"]},
		}
		
		that.importantElement = importantElement;
		
		var warnProId = data.warnProId;
		that.warnProId = warnProId;
		var element;
		if(warnProId.startsWith("I_")){
			element = this.elements.important;
			that.warnPro = "important";
		}else{
			that.warnPro = warnProObj[data.warnProId];
			if(!that.warnPro){
				return;
			}
			element = this.elements[that.warnPro];
			if(!element){
				return;
			}
		}
		//初始化研判的tab页
		this.initTabs(element);
		
		//客观强降水显示播放按钮
		if(that.warnPro == "heavyrain"){
			$(".objectives-play-btn").show();
		}else{
		}
		$(".objectives-play-btn").hide();
		//如果时间不存在则取查询时间，如果存在但为时间戳则转为字符串时间
		var startTime = data.startTime;
		if(!startTime){
			startTime = $("#happenTimeOpr").customDateBlack("getTime");
		}
		if(data.startTime && $.isNumeric(data.startTime)){
			startTime = new Date(data.startTime).format("yyyy-MM-dd hh:mm");
		}
		startTime = startTime.substring(0, 16);
		that.stationInfo.startTime = startTime;
		
		var contents = element.contents;
		var title = "";
		if(that.warnPro == "autostation"){
			title = data.stationName + element.title;
		}else{
			title = element.title;
		}
		var subtitle = ""
		if(warnProId.startsWith("I_")){
			subtitle = data.stationName + importantElement[warnProId].name + element.subtitle;
		}else{
			subtitle = element.subtitle;
		}
		$(".element-pop-wrap .element-pop-content").height(element.contentHeight);
		$(".element-pop-wrap .element-pop-title .title-content").text(title);
		$(".element-pop-content-wrap .element-pop-content-title .title-content").text(subtitle);
		$(".element-pop-content-wrap").append($("<input type='hidden' id='popWarnId' />").val(data.id));
		$(".element-pop-content-wrap").append($("<input type='hidden' id='popWarnProId' />").val(data.warnProId));
		if(data.WarningTime){
			$(".element-pop-content-wrap").append($("<input type='hidden' id='popWarningTime' />").val(data.WarningTime));
		}
		if(!element.url){
			that.buildElementContent(contents, data);
		}else{
			$.ajax({
				type : "POST",
				async : false,
				url : G_CONTEXT.contextPath + element.url + "?t=" + new Date().getTime() ,
				data : {strDate : startTime, userId : $("#userid").val(), stationId : data.stationId},
				success : function(result){
					var info;
					if(result && result.success && result.objectData && result.objectData.list){
						info = result.objectData.list[0];
						that.stationInfo.info = info;
					}
					that.buildElementContent(contents, data, info);
				}
			});
		}
		//渲染按钮
		if(element.btns && element.btns.length > 0){
			var $btnArea = $("<div class='btn-area'>");
			$(".element-pop-wrap").append($btnArea);
			$(element.btns).each(function(i, btn){
				if(codeId.length != 2 && btn.name == "制作预警指导"){
					return;
				}
				var $btn = $("<a class='btn btn-make btn-sm'></a>");
				$btnArea.append($btn);
				$btn.text(btn.name);
				$btn.unbind("click").bind("click", function(){
					if($.isFunction(btn.callBack)){
						btn.callBack();
					}
				});
			});
		}
	},
	buildElementContent : function(contents, data, info){//渲染pop内容
		var that = this;
		var $content = $("#elementPopContainer .element-pop-content").empty();
		$(contents).each(function(i, content){
			var $warnElementRow = $("<div class='warn-element-row'>");
				$content.append($warnElementRow);
				$(content.children).each(function(i, child){
					if(data.warnProId.startsWith("I_")){
						if(that.importantElement[data.warnProId].items.indexOf(child.item) == -1){
							return;
						}
					}
					var $warnElement = $("<div class='warn-element'/>").addClass(child.clazz);
					$warnElementRow.append($warnElement);
					var text = data[child.key] || (info ? info[child.key] : undefined);
					if($.isFunction(child.formatter)){
						text = child.formatter(text);
					}
					if((child.key == "windDirection" || child.key == "windExtDir") && text){
						text = that.getWindDirection(text);
					}
					$warnElement.append($("<div class='warn-element-name'>").attr("title", child.name).text(child.name + "："));
					text = text || "--";
					if(text != "--"){
						text += child.unit;
					}
					$warnElement.append($("<div class='warn-element-content'>").attr("title", text).text(text));
				});
		});
	},
	clearAllLayer : function(){//清除图层
		var that = this;
//		if(!$.isEmptyObject(that.referenceProductLayerIds)){
//			$(that.referenceProductLayerIds).each(function(i, layerId){
//				if(GIS.Warning){
//					GIS.Warning.ReMoveLayerById("nGis", layerId);
//				}
//			});
//			that.referenceProductLayerIds = [];
//		}
	},
	getWindDirection : function(wd){//获取风向
		return G_CONTEXT.getWindDireObj(wd).CH;
	},
	initTabs : function(element, data){//初始化研判tab页
		$(".xgyp-title .title-content").text(element.xgyptitle);
		var $tabs = $(".xgyp-title .xgyp-tabs").empty();
		var $tabUl = $("<ul class='xgyp-tabs-ul'>");
		$tabs.append($tabUl);
		$(element.xgyptabs).each(function(i, tab){
			$tabUl.append($("<li class='xgyp-tabs-option'>").text(tab.name).attr("url", G_CONTEXT.contextPath + tab.url));
		});
		$tabs.find("li").last().trigger("click");
	},
	bindEvent : function(){
		var that = this;
		//关闭pop框
		$("#elementPopContainer .close-btn").unbind("click").bind("click", function(){
			that.clearAllLayer();
			closeInfoWindow("nGis");
			GIS.Warning.ClearLayerById("nGis","clickSelectedLayer");
			$("#elementPopContainer").remove();
		});
		
		$(".element-pop-container").undelegate(".xgyp-tabs-option", "click").delegate(".xgyp-tabs-option", "click", function(){
			var $this = $(this);
			if($this.hasClass("xgyp-selected")){
				return;
			}
			$this.addClass("xgyp-selected").siblings().removeClass("xgyp-selected");
			var url = $this.attr("url");
			$(".xgyp-content").empty();
			if(url && url.indexOf(".do") > -1){
				$.get(url + "?t=" + new Date().getTime(), {}, function(html){
					$(".xgyp-content").html(html);
				}, "html");
			}
		});
		
		$("#elementPopContainer .objectives-play-btn").unbind("click").bind("click", function(){
			return;
			that.clearAllLayer();
			if(!that.warnProId || that.warnProId == ""){
				return;
			}
			var gisData;
			var warnProId = that.warnProId;
			var data = ZHYJ_MAIN.gisMapData;
			for(var i = 0; i < data.length; i++){
				var warnInfo = data[i];
				if(warnInfo.warnProId == warnProId){
					if(!gisData){
						gisData = $.extend({}, warnInfo);
					}else{
						gisData.Features.push(warnInfo.Features);
					}
				}
			}
//			gisData.Features.push({"rings" : [[[112.88919268877649,38.44252885331656],[112.86808990864517,38.422905243574895],[112.85167701110653,38.39960477688831],[112.83970155872375,38.37295589055133],[112.83191111406,38.343287021858494],[112.82846880109675,38.31693623706275],[112.82752501323165,38.28973351875514],[112.8288242908762,38.26115587526638],[112.83223845152112,38.23137008026161],[112.83763931265713,38.200542907405996],[112.84386899544796,38.172946964596754],[112.85100276042084,38.14627000634491],[112.85925759061735,38.11918901367435],[112.86856109448745,38.091798172634306],[112.87884088048104,38.064191669274024],[112.89002455704805,38.036463689642744],[112.90166373477705,38.00954983946215],[112.9136329189886,37.9835114852329],[112.92621486765265,37.95760800603126],[112.93934942191116,37.93191767238962],[112.95297642290608,37.90651875484041],[112.96703571177937,37.881489523916045],[112.98146712967298,37.85690825014891],[112.9971930829498,37.83128600348949],[113.01333903286027,37.8061459144708],[113.02969670602369,37.78180783439505],[113.04619133685854,37.75836903807862],[113.06274815978338,37.735926800337836],[113.07929240921672,37.71457839598907],[113.09899832640406,37.690570962908936],[113.11973507592595,37.667036936841725],[113.14002646308947,37.64584320292735],[113.1597162905224,37.62719298396429],[113.17864836085252,37.611289502751],[113.19794342553253,37.5972851950356],[113.21997767504713,37.58323839204535],[113.24460230400246,37.569187949908674],[113.27161203498763,37.555216858142714],[113.30080159059173,37.541408106264626],[113.32782232954628,37.52958589431931],[113.35286746579125,37.51932508488748],[113.3788838344949,37.509290491777826],[113.40577769335349,37.49952001311312],[113.43345530006332,37.490051547016165],[113.46182291232061,37.480922991609724],[113.49078678782169,37.47217224501659],[113.51882030720391,37.46422953012008],[113.54643752245379,37.45689875147353],[113.57433437446001,37.44998486568146],[113.60243658079735,37.44351790363023],[113.63066985904052,37.43752789620625],[113.65895992676428,37.43204487429589],[113.68723250154336,37.427098868785556],[113.71572887821979,37.42267408185285],[113.74555707480035,37.418674789359265],[113.77510619511739,37.41538949819283],[113.80428648728605,37.41285449323047],[113.83300819942143,37.4111060593491],[113.86118157963863,37.410180481425655],[113.88871687605278,37.41011404433706],[113.91643400913301,37.41098799557213],[113.94805377623669,37.41331144360092],[113.97828265201882,37.417095906829964],[114.00695658994829,37.42240770596325],[114.03391154349404,37.42931316170478],[114.05898346612497,37.43787859475854],[114.08455071603358,37.44948497960305],[114.11044103697732,37.465567971590644],[114.13232834116819,37.484743493633374],[114.14986798410551,37.507150878552],[114.16271532128863,37.53292945916726],[114.16992270415595,37.55807643280816],[114.17322859692102,37.5842790515729],[114.17286900618925,37.61165222185489],[114.16899571121166,37.64008970734317],[114.16176049123929,37.66948527172679],[114.15131512552318,37.6997326786948],[114.13781139331437,37.73072569193624],[114.12526033228094,37.75533595323059],[114.11258214137769,37.77766034839412],[114.09859701632047,37.80021978604245],[114.08335657824088,37.82297813450047],[114.06691244827051,37.84589926209307],[114.04931624754096,37.868947037145155],[114.03061959718377,37.892085327981604],[114.01087411833055,37.91527800292732],[113.99013143211288,37.938488930307194],[113.96844315966231,37.961681978446116],[113.94740028798729,37.98327366531461],[113.92790419939345,38.002570441745036],[113.90784632858241,38.021784659257015],[113.88725690425841,38.04089515958289],[113.86616615512565,38.05988078445498],[113.84460430988837,38.07872037560562],[113.82260159725074,38.09739277476713],[113.80018824591701,38.11587682367184],[113.77739448459137,38.13415136405208],[113.75425054197805,38.15219523764018],[113.73078664678125,38.16998728616845],[113.7070330277052,38.18750635136924],[113.68302559883873,38.20472725329308],[113.6588600778492,38.22158412452611],[113.6344966711299,38.23810672849886],[113.60996532218755,38.25427410656471],[113.58529597452885,38.270065300077],[113.56051857166051,38.285459350389104],[113.53566305708921,38.30043529885438],[113.51075937432168,38.3149721868262],[113.48583746686462,38.32904905565792],[113.46092727822473,38.3426449467029],[113.43605875190872,38.3557389013145],[113.41126183142329,38.36830996084609],[113.38656646027515,38.38033716665103],[113.35879370568522,38.39325924356589],[113.32987210823798,38.40601168294973],[113.30123367419391,38.41789959420377],[113.27292850558469,38.428887908931074],[113.24500670444203,38.43894155873473],[113.21751837279764,38.44802547521783],[113.1905136126832,38.456104589983454],[113.16404252613044,38.46314383463467],[113.13815521517104,38.46910814077458],[113.11290178183668,38.473962440006254],[113.08543717730531,38.47803755773408],[113.05166937085086,38.48107867303872],[113.01956714336575,38.481586944348486],[112.98927772337274,38.479459320587445],[112.96094833939456,38.47459275067966],[112.93472621995397,38.46688418354921],[112.9107585935737,38.456230568120155],[112.88919268877649,38.44252885331656]]]});
//			gisData.Features.push({"rings" : [[[114.19670651148023,38.817293961734826],[114.17277184171395,38.80042490611488],[114.15265593727152,38.77946619624685],[114.13619446105173,38.75472041833648],[114.12322307595335,38.72649015858953],[114.1140933175653,38.69715793702635],[114.10864943214968,38.670959527626735],[114.10503335486041,38.643161726540704],[114.10316863924282,38.61390529104394],[114.10297883884225,38.58333097841214],[114.10438750720402,38.55157954592098],[114.10719435463757,38.5199222957002],[114.1106532845775,38.49229199936556],[114.11504992472427,38.46413060947765],[114.12034170012848,38.43551651729635],[114.12648603584064,38.40652811408157],[114.13344035691134,38.3772437910932],[114.14116208839111,38.347741939591145],[114.14960865533052,38.318100950835294],[114.15832586079878,38.28969428375676],[114.16751393744455,38.26164388714621],[114.17723881117617,38.23367231115864],[114.18746457196704,38.20584567524373],[114.19815530979061,38.17823009885113],[114.20927511462027,38.150891701430524],[114.22078807642944,38.12389660243156],[114.23265828519156,38.0973109213039],[114.24588271503977,38.069041075645146],[114.25948702378398,38.04131774221929],[114.27337912580147,38.014326486228065],[114.28751284421536,37.98815233099164],[114.30184200214873,37.96288029983021],[114.31632042272469,37.93859541606397],[114.33090192906633,37.9153827030131],[114.34890065751034,37.888441072186644],[114.36800258639023,37.86193507792933],[114.3870021779498,37.837766040186956],[114.40579685319442,37.81612283285681],[114.42428403312944,37.7971943298362],[114.44257284079275,37.780996730772266],[114.46334516854715,37.76547350070675],[114.48711419185699,37.750162855971624],[114.51362683169353,37.73515527027923],[114.54263000902806,37.720541217341875],[114.57040785082751,37.707906256189744],[114.59621090944992,37.69714630866455],[114.62313409368315,37.68677928473879],[114.65105446879107,37.67684913258947],[114.67984910003759,37.66739980039358],[114.70939505268657,37.65847523632812],[114.73847776703194,37.650408727422324],[114.76687619082398,37.643191087273834],[114.79561457209941,37.636533084127684],[114.8245951079056,37.63046968175092],[114.85371999528991,37.62503584391056],[114.8828914312997,37.62026653437365],[114.91201161298231,37.61619671690722],[114.94256511239358,37.6127003953219],[114.97284185661402,37.61006203834546],[115.00272305072508,37.608323203824995],[115.0320938599312,37.607524944274076],[115.06083944943673,37.60770831220628],[115.08884498444611,37.60891436013517],[115.12035331947827,37.61166011928852],[115.15128421708789,37.61604191505797],[115.18061060075398,37.62207795275575],[115.2081370402056,37.62983809712811],[115.23366810517173,37.63939221292125],[115.2607847257807,37.65296520824483],[115.28601405206923,37.67037075463178],[115.30709006516935,37.690945949278095],[115.32363229538396,37.714826807032956],[115.33465275114045,37.73993008598637],[115.34138638544661,37.765510676413946],[115.34476990944427,37.79280938236543],[115.34493214502717,37.821698270430886],[115.34200191408917,37.852049407200376],[115.33610803852403,37.88373485926396],[115.32737934022556,37.91662669321169],[115.31729056054333,37.94692273050441],[115.30786526484152,37.97137796479703],[115.29719774468833,37.99626745605847],[115.28533311774989,38.021546397798886],[115.27231650169233,38.04716998352843],[115.25819301418177,38.07309340675726],[115.24300777288433,38.099271860995536],[115.22680589546616,38.12566053975341],[115.20963249959335,38.15221463654104],[115.19153270293205,38.17888934486858],[115.17297692034347,38.20505284790567],[115.15623777300372,38.22776501465667],[115.1389240435347,38.25047285303326],[115.12106325158801,38.27314903318666],[115.10268291681534,38.29576622526812],[115.08381055886831,38.31829709942885],[115.06447369739858,38.34071432582008],[115.04469985205779,38.36299057459306],[115.0245165424976,38.38509851589902],[115.00395128836963,38.40701081988917],[114.98303160932555,38.42870015671476],[114.96178502501701,38.45013919652701],[114.94022737913171,38.47131192301684],[114.91828689351485,38.49228373112895],[114.89609949616674,38.512919363173616],[114.87369317020406,38.53319102903353],[114.85109589874357,38.55307093859139],[114.82833566490193,38.572531301729875],[114.80544045179585,38.59154432833167],[114.78243824254206,38.610082228279474],[114.75935702025724,38.628117211455965],[114.73622476805811,38.64562148774384],[114.71306946906137,38.662567267025786],[114.68991910638373,38.67892675918449],[114.66628650967864,38.69501623370157],[114.63878623261566,38.712944347862646],[114.6114210980802,38.729910478618464],[114.58423864696881,38.745867412961786],[114.55728642017803,38.760767937885355],[114.5306119586044,38.77456484038191],[114.50426280314446,38.787210907444205],[114.47828649469474,38.79865892606499],[114.45273057415181,38.808861683237],[114.42764258241219,38.81777196595299],[114.40230985535989,38.825557361178106],[114.3684394104289,38.83384658198162],[114.33584195752412,38.8392041925206],[114.3046534091623,38.841495217666115],[114.27500967786023,38.84058468228923],[114.24704667613466,38.836337611261015],[114.22090031650241,38.828619029452526],[114.19670651148023,38.817293961734826]]]});
//			gisData.Features.push({"rings" : [[[115.28768938265343,39.183730956632694],[115.26432205192184,39.155748072666334],[115.248076900854,39.124110272228876],[115.23852257614651,39.089173485998224],[115.23522772449587,39.051293644652254],[115.23683012943074,39.01890215335384],[115.24189110197922,38.9854928446602],[115.25019165289321,38.950811268477125],[115.26151584401687,38.91503560592337],[115.27564773719436,38.87834403811772],[115.28956801264529,38.8468649352856],[115.30461765269949,38.81610163383919],[115.32114202828481,38.785046012671685],[115.33902535918567,38.75379360769366],[115.35815186518647,38.722439954815655],[115.37840576607167,38.691080589948236],[115.39883256070851,38.661015955277186],[115.41940176214939,38.63206911104633],[115.44065750051479,38.60335666052172],[115.46250643049979,38.57495562747342],[115.48485520679944,38.54694303567149],[115.50761048410884,38.51939590888598],[115.53067891712305,38.49239127088697],[115.55529254273867,38.46452994823781],[115.58036194734511,38.437106606924075],[115.6054557058128,38.410580755317675],[115.63045934496017,38.385046850831564],[115.65525839160571,38.36059935087867],[115.67973837256785,38.33733271287194],[115.70715881574031,38.312326444455095],[115.7371278058698,38.28635008596724],[115.76592174282575,38.26285895147703],[115.79329761669206,38.24205356033481],[115.8190124175526,38.22413443189094],[115.84371457322679,38.20873024040839],[115.87137400499145,38.19330401023406],[115.90226219404352,38.17763578035829],[115.9361100833497,38.16184846218355],[115.97264861587675,38.146064967112316],[116.0073084086669,38.13208310700284],[116.03875207171731,38.120117229417154],[116.0713756609479,38.10834953389872],[116.1050547842744,38.09683684559478],[116.13966504961257,38.08563598965258],[116.17508206487818,38.07480379121935],[116.21118143798698,38.06439707544235],[116.24569004902457,38.055036616393735],[116.2802330406767,38.046239183478235],[116.31505831809099,38.0379533684509],[116.35006512599739,38.030225198622006],[116.38515270912583,38.02310070130181],[116.42022031220627,38.01662590380057],[116.45516717996863,38.01084683342858],[116.49185744639173,38.005546446334016],[116.52878894926496,38.001062368935145],[116.56521666914044,37.99754817292306],[116.60101556986658,37.9950609776697],[116.63606061529171,37.99365790254701],[116.67022676926423,37.99339606692693],[116.70459750492608,37.994391093260276],[116.74394768594486,37.997347963415756],[116.78133098472632,38.002332903636855],[116.81651147546026,38.009453690226124],[116.84925323233642,38.018818099486076],[116.87932032954458,38.030533907719246],[116.91204475559512,38.04817293652364],[116.94106019628892,38.070650893564824],[116.96442351220398,38.09753582942808],[116.98165020193544,38.12904907542913],[116.99160486598994,38.16162206003278],[116.99581937716304,38.193812701879644],[116.99525733964886,38.22725615953428],[116.99011630298867,38.26183214230084],[116.9805938167237,38.29742035948349],[116.96688743039523,38.333900520386415],[116.94919469354451,38.37115233431377],[116.92966496090807,38.40583885136067],[116.91297042995947,38.43223759463967],[116.89462826535375,38.458853855590675],[116.87470305229398,38.4856483073746],[116.85325937598323,38.512581623152386],[116.83036182162458,38.53961447608494],[116.80607497442111,38.566707539333215],[116.78046341957588,38.59382148605811],[116.75359174229196,38.62091698942057],[116.72552452777244,38.64795472258152],[116.69632636122039,38.674895358701875],[116.66923622454237,38.69893766600288],[116.64332698325367,38.7211625375276],[116.61675455511299,38.743245364234845],[116.58955633730723,38.76516337445122],[116.5617697270233,38.78689379650331],[116.53343212144812,38.8084138587177],[116.50458091776856,38.829700789421],[116.47525351317158,38.850731816939785],[116.44548730484405,38.87148416960066],[116.4153196899729,38.891935075730224],[116.38478806574501,38.91206176365505],[116.35392982934732,38.93184146170175],[116.32278237796673,38.9512513981969],[116.29141232938322,38.97025135611585],[116.2598337204775,38.988833612058485],[116.22807840194305,39.006978801307746],[116.1961836476198,39.02466422729796],[116.16418673134766,39.04186719346344],[116.13212492696653,39.0585650032385],[116.10003550831634,39.07473496005744],[116.06795574923702,39.09035436735458],[116.03592292356845,39.10540052856423],[116.00397430515058,39.119850747120715],[115.97214716782331,39.13368232645833],[115.94047878542656,39.14687257001139],[115.90869540852634,39.15951960948803],[115.87133906760371,39.17359911609931],[115.8343813912952,39.186655593145],[115.79788629124697,39.198650123924295],[115.76191767910515,39.209543791736415],[115.72653946651592,39.21929767988058],[115.69181556512542,39.227872871656004],[115.65780988657983,39.23523045036189],[115.62458634252526,39.24133149929746],[115.5922088446079,39.246137101761924],[115.56074130447388,39.2496083410545],[115.52535030637709,39.251916363898005],[115.48320839600792,39.25209528239443],[115.44347078767919,39.24916603031468],[115.40633297013407,39.243009571811896],[115.37199043211575,39.23350687103918],[115.34063866236743,39.22053889214967],[115.31247314963225,39.203986599296464],[115.28768938265343,39.183730956632694]]]});
//			gisData.Features.push({"rings" : [[[116.54523452423473,39.908276832908015],[116.51614737586628,39.88670794350399],[116.49256685514217,39.85979717018884],[116.47420308738786,39.8280177362548],[116.46091883215799,39.79236788727512],[116.4534277300214,39.76037871841833],[116.44879924303379,39.72608553096984],[116.44688163647713,39.689736033367524],[116.44752317563338,39.651577934049264],[116.45043244983701,39.61321386102701],[116.45461202044312,39.579339358806436],[116.46025675849081,39.54469881306965],[116.46728040628496,39.50943304036275],[116.47559670613042,39.473682857231815],[116.48511940033208,39.43758908022294],[116.49555085864455,39.40198074111151],[116.50646902713474,39.367840939690566],[116.51822873097626,39.333760730593205],[116.53075856515335,39.29985668321857],[116.54398712465023,39.26624536696581],[116.55784300445116,39.23304335123409],[116.57229889500529,39.200269874623494],[116.5882755372234,39.16598168683599],[116.6047202131434,39.13257456223292],[116.6215451265428,39.1001918290216],[116.6386624811991,39.06897681540934],[116.65598448088986,39.039072849603485],[116.67432407044018,39.00919839783703],[116.696489219887,38.97551558417948],[116.71851431038424,38.94471226925481],[116.74021976424825,38.917081615419406],[116.76142600379545,38.892916785029676],[116.78233810115242,38.87206471496868],[116.80606539547888,38.8511627355583],[116.83300867812599,38.829689233735465],[116.8629411386025,38.80777883225104],[116.89563596641709,38.78556615385587],[116.93028072730806,38.76354647163577],[116.95880926386458,38.74637588242115],[116.98859233362238,38.72924512836094],[117.01952803829057,38.71221469090884],[117.0515144795783,38.69534505151853],[117.08444975919467,38.67869669164372],[117.11823197884883,38.662330092738095],[117.15275924024988,38.64630573625534],[117.1856094995512,38.63169328402324],[117.2185867247087,38.617628633548904],[117.25195191542534,38.60400452976582],[117.28562449262607,38.590868800165026],[117.31952387723588,38.578269272237584],[117.35356949017974,38.56625377347453],[117.38768075238262,38.554870131366926],[117.42197206827265,38.544106948087546],[117.45825468428782,38.53349105423478],[117.49433001313572,38.523762340725035],[117.53010008891547,38.51497895495262],[117.56546694572621,38.507199044311825],[117.60033261766705,38.50048075619695],[117.63459913883709,38.49488223800229],[117.66816854333547,38.490461637122145],[117.70681332717278,38.486835109923966],[117.74567533054747,38.48499803788961],[117.7829769694754,38.48524319259251],[117.81853594226264,38.487678778707796],[117.85216994721524,38.49241300091059],[117.88369668263928,38.499554063876026],[117.91986548543964,38.51203047239799],[117.95307097747416,38.529255877615874],[117.98169295690084,38.55112679568068],[118.00533972643763,38.57787571744993],[118.02310760179893,38.60857041242289],[118.03440295706466,38.63935274877801],[118.04108776397518,38.67220443096783],[118.0433401265715,38.70697201889794],[118.04133814889458,38.743502072473945],[118.03525993498543,38.781641151601434],[118.02528358888503,38.821235816186004],[118.01189370048759,38.86131030375791],[118.000300873454,38.890463209309175],[117.98704876986244,38.920122852580384],[117.97219754054834,38.95023741245727],[117.95580733634706,38.980755067825534],[117.93793830809402,39.01162399757091],[117.91865060662464,39.04279238057911],[117.89800438277427,39.07420839573585],[117.87605978737835,39.105820221926855],[117.85287697127227,39.137576038037835],[117.82851608529143,39.16942402295452],[117.80617256495985,39.19745972724749],[117.78422706750528,39.22403802542829],[117.76157634562415,39.250582684044524],[117.73825524123517,39.27706368610573],[117.71429859625705,39.303451014621444],[117.68974125260854,39.329714652601226],[117.66461805220837,39.355824583054606],[117.63896383697525,39.381750788991134],[117.61281344882792,39.40746325342035],[117.5862017296851,39.432931959351805],[117.55916352146552,39.45812688979504],[117.53173366608789,39.48301802775959],[117.50399670726586,39.5075320063624],[117.47604437395604,39.53159387688511],[117.44780782450681,39.55526645009009],[117.41932132786734,39.57852020261129],[117.39061915298682,39.60132561108265],[117.3617355688144,39.62365315213813],[117.33270484429929,39.64547330241169],[117.30356124839065,39.66675653853726],[117.27433905003767,39.687473337148795],[117.24507251818953,39.70759417488025],[117.21579592179539,39.727089528365575],[117.18654352980447,39.74592987423871],[117.1573496111659,39.764085689133616],[117.12367006849891,39.78421079351388],[117.08936825842862,39.8037783655961],[117.05530960545171,39.82224532528233],[117.02155119399154,39.83956249323189],[116.98815010847147,39.85568069010408],[116.95516343331485,39.87055073655824],[116.92264825294504,39.88412345325368],[116.8906616517854,39.89634966084971],[116.85926071425925,39.90718018000565],[116.82850252479,39.91656583138082],[116.79419513037168,39.925463583131375],[116.75254837878818,39.9337563096476],[116.71264716305237,39.93870884999881],[116.674660351797,39.9401757205744],[116.63875681365481,39.938011437763734],[116.60510541725854,39.9320705179562],[116.57387503124093,39.92220747754117],[116.54523452423473,39.908276832908015]]]});
			if(gisData){
				GIS.Warning.showAreaAnimation("nGis", gisData);
				that.referenceProductLayerIds.push(gisData.id + "_animation");
			}
		});
		
		$('.element-pop-container').undelegate(".element-pop-title").delegate(".element-pop-title","mousedown",function(){
			var isMove = true;
			var _this = $(".esriPopup");
			$(this).css({"cursor": "move"});//点击鼠标切换为手势图形
			var m_x = Number(_this.css("left").split("px")[0]);//点击窗体时，left
			var m_y = Number(_this.css("top").split("px")[0]);//点击窗体时，top
			var abs_x = event.pageX;//点击窗体时，左边距
			var abs_y = event.pageY;//点击窗体时，上边距
			//单击住头部可进行拖拽，计算移动大小，以及移动范围限制
			$(document).unbind('mousemove').bind('mousemove',function(event){
				if(isMove) {
					//event.pageX,移动后的左边距;event.pageY,移动后的上边距
					var ebs_x = m_x-(abs_x-event.pageX); //移动后的left
					var ebs_y = m_y+(event.pageY - abs_y);//移动后的top
					
					var body_w = $("body").width();
					var body_h = $("body").height();
					var div_w = _this.width();
					var div_h = _this.height();
					//不可超出左右边框
					if(ebs_x <= 0) {
						ebs_x = 0;
					} else if (ebs_x > body_w - div_w) {
						ebs_x = body_w - div_w;
					} else {
						
					}
					//不可超出上下边框
					if(ebs_y <= 0) {
						ebs_y = 0;
					} else if (ebs_y > body_h - div_h - 50) {
						ebs_y = body_h - div_h - 50;
					} else {
						
					}
					//重新设定弹出框的左边距，上边距
					_this.css({'left':ebs_x,'top':ebs_y });
				}
			}).mouseup(function(){
				isMove = false
				$(document).unbind('mousemove');
				$(".element-pop-title").css({"cursor": "default"});//点击鼠标切换为手势图形
			});//鼠标移除事件；单击事件结束事件。
		});
	},
	closePop : function(warningTime, warnProId, id){
		if(warningTime){
			if(warnProId){
				if($("#popWarningTime").val() == warningTime && 
						$("#popWarnProId").val() == warnProId){
					if(id){
						if($("#popWarnId").val() == id){
							closeInfoWindow("nGis");
						}
					}else{
						closeInfoWindow("nGis");
					}
				}
			}else{
				if($("#popWarningTime").val() == warningTime){
					closeInfoWindow("nGis");
				}
			}
		}
	}
}